В процессе работы компонента значения его свойств с модификатором **$save** автоматически сохраняются в Web-хранилище браузера, а затем восстанавливаются оттуда при обновлении страницы или при перезапуске браузера.

Для привязки данных в Web-хранилище к конкретному экземпляру компонента используется директива **~save-key**, в которой задается его индивидуальный идентификатор. Данные записываются в Web-хранилище в виде пары **ключ/значение**. Значение определяется свойствами с модификатором **$save**, а ключ задается директивой **~save-key** в теге компонента.

Чтобы вернуть свойства компонента к значениям по умолчанию, необходимо удалить их данные из Web-хранилища. Для этого служит метод компонента **$resetSettings()**. Метод не имеет параметров и удаляет из хранилища данные сразу всех свойств компонента. Вернуть начальное значение только одному конкретному свойству не получится.

Для примера объявим компонент, сохраняющий в Web-хранилище значение, введенное в строку ввода:

```javascript _edit_[test-component.js]
ODA({
    is: 'test-component',
    template: `
        <input ::value>
        <button @tap="clear">Очистить</button>
    `,
    value: {
        $def: 'Пример для ~save-key',
        $save: true
    },
    clear() {
        this.$resetSettings();
        window.location.reload(true);
    }
});
```

В компоненте введенное значение попадает в свойство **value**, имеющее модификатор **$save** со значением **true**, поэтому его текущее значение автоматически запоминается в Web-хранилище и восстанавливается после перезагрузки страницы и браузера. Очистка хранилища для восстановления значения по умолчанию осуществляется кнопкой «Очистить».

Пример использования директивы **~save-key** в теге компонента:

```javascript _run_edit_[my-component.js]_{test-component.js}
ODA({
    is: 'my-component',
    template:`
        <test-component ~save-key="'myKey'"></test-component>
    `
});
```

В данном примере в качестве ключа сохранения данных для компонента **test-component** используется строка **'myKey'**. Запишите что-нибудь в поле ввода и обновите страницу или перезапустите браузер. Можете убедиться, что введенные данные не теряются.

```info_md
Удалить из хранилища сохраненные данные всех компонентов для текущего Web-сайта можно командой **window.localStorage.clear()**.
```

При нажатии на эту красную кнопку восстанавливаются значения по умолчанию для всех примеров на данной странице. Чтобы это увидеть, необходимо перезагрузить страницу:

```javascript _run_edit_[my-component.js]
ODA({
    is: 'my-component',
    template:`
        <button @tap="window.localStorage.clear()" style="background:red">RESET</button>
        `
});
```

В отличие от технологии куки (**cookie**), способ хранения пользовательских данных в Web-хранилище имеет ряд достоинств:

1. Объекты Web-хранилища не отправляются на сервер при каждом запросе. Поэтому в хранилище можно хранить гораздо больше данных для каждого сайта. Большинство браузеров могут сохранить минимум 2 мегабайта данных (или больше), и этот объем можно поменять в настройках.

1. Сервер не может манипулировать объектами хранилища через HTTP-заголовки. Всё делается при помощи JavaScript.

1. Web-хранилище привязано к источнику (домен/протокол/порт). Это значит, что разные протоколы или поддомены определяют разные объекты хранилища и они не могут получить доступ к данным друг друга.

Если в проекте применяется несколько экземпляров одного и того же компонента, и у них в директиве **~save-key** указано одно и то же значение ключа, то в хранилище будет записываться значение из того свойства, которое изменено последним, независимо от того, в каком экземпляре компонента оно находится. В этом случае при обновлении страницы сохраненное значение будет восстанавливаться для всех однотипных компонентов, у которых совпадает значение ключа.

Например,

```javascript _run_edit_[my-component.js]_{test-component.js}
ODA({
    is: 'my-component',
    template:`
        <test-component ~save-key="'key1'"></test-component><br>
        <test-component ~save-key="'key2'"></test-component><br>
        <test-component ~save-key="'key1'"></test-component><br>
        <button @tap="window.location.reload(true)">Обновить</button>
        `
});
```

В данном примере три одинаковых компонента содержат директиву **~save-key**, но в ней используются два разных ключа: **key1** и **key2**, поэтому сохраняться будут значения только для двух компонентов. Ключ **key1** имеют первый и третий компоненты, и в хранилище будет записываться одно общее для них значение, то которое изменилось последним. При обновлении страницы, это значение будет восстанавливаться как для первого, так и для третьего компонента.

```info_md
Обратите внимание, что отсутствие директивы **~save-key** НЕ отменяет сохранение свойств с модификатором **$save**. Свойства по-прежнему сохраняются в хранилище, но без ключа. Фактически все компоненты без директивы **~save-key** имеют одно и то же "пустое" значение ключа. Соответственно сохранение и восстановление значений свойств осуществляется также как для компонентов с одинаковыми ключами.
```

Например,

```javascript_run_edit_nocopy_[my-component.js]_{test-component.js}
ODA({
    is: 'my-component',
    template:`
        <test-component></test-component><br>
        <test-component></test-component><br>
        <test-component></test-component><br>
        <button @tap="window.location.reload(true)">Обновить</button>
        `
});
```

В данном примере при сохранении значения свойств не используется директива **~save-key**, поэтому для всех компонентов будет восстанавливаться одно и то же значение, введенное последним.

```info_md
Данные компонентов разного типа всегда хранятся в независимых областях Web-хранилища, даже если у них совпадают значения директивы **~save-key**. Поэтому они не могут влиять на сохраненные данные друг друга и не могут удалять их.
```

Например,

```javascript _run_edit_[my-component.js]_{test-component.js}
ODA({
    is: 'new-component',
    extends: 'test-component'
});

ODA({
    is: 'my-component',
    template:`
        test-component: <test-component ~save-key="'myKey1'"></test-component><br>
        new-component: <new-component ~save-key="'myKey1'"></new-component>
        `
});
```

В данном примере из компонента **test-component** был создан наследный компонент **new-component**. Оба эти компонента используются с директивами **~save-key** с одним и тем же ключом **'myKey1'**. Введите в них разные данные и обновите страницу. Т.к. с точки зрения фреймворка это компоненты разного типа, то их данные сохраняются и восстанавливаются независимо друг от друга.

Действие модификатора **$save** основано на механизме реактивности, т.е. при изменении значения свойства, оно автоматически записывается в Web-хранилище.

Следует отметить, что автосохранение массивов срабатывает только при изменении указателя на массив, а не при изменении его отдельных элементов.

Например,

```javascript _run_edit_error_[my-component.js]
ODA({
    is: 'test-component',
    template: `
        <input type="range" ::value="value[0]">
        <button @tap="clear">Очистить</button>
    `,
    value: {
        $def: [0],
        $save: true
    },
    clear() {
        this.$resetSettings();
        window.location.reload(true);
    }
});

ODA({
    is: 'my-component',
    template:`
        <test-component ~save-key="'key3'"></test-component>
    `
});
```

В данном примере положение ползунка передается в элемент с индексом **0** массива **value**, который объявлен с модификатором **$save**. Переместите ползунок и перезагрузите страницу, чтобы убедиться, что данные из массива **value** не восстанавливаются, т.к. не сохраняются в хранилище.

Добавим в HTML-элемент **input** перехват события **change**, в обработчике которого будем присваивать указателю **value** новый массив с актуальным положением ползунка.

```javascript _run_edit_[my-component.js]
ODA({
    is: 'test-component',
    template: `
        <input type="range" ::value="value[0]" @change="value=[...value]">
        <button @tap="clear">Очистить</button>
    `,
    value: {
        $def: [0],
        $save: true
    },
    clear() {
        this.$resetSettings();
        window.location.reload(true);
    }
});

ODA({
    is: 'my-component',
    template:`
        <test-component ~save-key="'key4'"></test-component>
    `
});
```

Можно видеть, что теперь положение ползунка сохраняется между перезагрузками страницы.

Аналогично, автосохранение объектов срабатывает только при изменении указателя на объект, а не при изменении его отдельных свойств.

Например,

```javascript _run_edit_error_[my-component.js]
ODA({
    is: 'test-component',
    template: `
        <input type="range" ::value="value.prop">
        <button @tap="clear">Очистить</button>
    `,
    value: {
        $def: {
            prop: 0
        },
        $save: true
    },
    clear() {
        this.$resetSettings();
        window.location.reload(true);
    }
});

ODA({
    is: 'my-component',
    template:`
        <test-component ~save-key="'key5'"></test-component>
    `
});
```

В данном примере положение ползунка передается в свойство **prop** объекта **value**, который объявлен с модификатором **$save**. Переместите ползунок и перезагрузите страницу, чтобы убедиться, что данные из объекта **value** не восстанавливаются, т.к. не сохраняются в хранилище.

Добавим в HTML-элемент **input** перехват события **change**, в обработчике которого будем присваивать указателю **value** новый объект с актуальным положением ползунка.

```javascript _run_edit_[my-component.js]
ODA({
    is: 'test-component',
    template: `
        <input type="range" ::value="value.prop" @change="value={...value}">
        <button @tap="clear">Очистить</button>
    `,
    value: {
        $def: {
            prop: 0
        },
        $save: true
    },
    clear() {
        this.$resetSettings();
        window.location.reload(true);
    }
});

ODA({
    is: 'my-component',
    template:`
        <test-component ~save-key="'key6'"></test-component>
    `
});
```

Можно видеть, что теперь положение ползунка сохраняется между перезагрузками страницы.

```like_md
Узнать больше о работе с Web-хранилищем можно в статье посвященной модификатору **$save**.
```

<div style="position:relative;padding-bottom:48%; margin:10px">
    <iframe src="https://www.youtube.com/embed/uOQBlyWafe4?start=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen
    	style="position:absolute;width:100%;height:100%;"></iframe>
</div>

