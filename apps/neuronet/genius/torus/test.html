<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <button id="btn">PRESS</button>
</body>
<script type="module">
    import '../../../../oda.js';
    import {tensor} from "./torus.js";

    btn.onclick = (e)=>{
        console.time('time')
        let _x = 50;
        let _k = 30;
        let _y = 10;
        let _z = 20;
        let _m = 70;

        // let out = tensor.zeros([_z, _y, _k], Float32Array).data
        let t0 = tensor.arange([_x, _k, _m]);
        let t1 = tensor.arange([_y, _x]);
        let t2 = tensor.arange([_z, _y]);
        let out = tensor.einsum('xkm, yx, zy, xkm->ykz', [t0, t1, t2, t0])


        //
        // let t4 = t0
        // let v0, v1, v2, v3;
        // // for(let x = 0; x <_x ; x++) {
        // //     let _kx = _k * x
        // //     for (let m = 0; m < _m; m++) {
        // //         let idx = -1;
        // //         for (let y = 0; y < _y; y++) {
        // //             let idx1 = x + _x * y;
        // //             v1 = t1[idx1];
        // //             for (let k = 0; k < _k; k++) {
        // //                 let idx0 = m + _m * (k + _kx)
        // //                 v0 = v3 = t0[idx0];
        // //                 let v013 = v0 * v1 * v3
        // //                 for (let z = 0; z < _z; z++) {
        // //                     let idx2 = y + _y * z;
        // //                     v2 = t2[idx2];
        // //                     out[++idx] += v013 * v2;
        // //                 }
        // //             }
        // //         }
        // //     }
        // // }
        //
        // let idx = -1;
        // for (let y = 0; y < _y; y++) {
        //     for (let k = 0; k < _k; k++) {
        //         for (let z = 0; z < _z; z++) {
        //             v2 = t2[y + _y * z];
        //             let sum = 0;
        //             for(let x = 0; x <_x ; x++) {
        //                 v1 = t1[x + _x * y];
        //                 let mult = v1 * v2;
        //                 for (let m = 0; m < _m; m++) {
        //                     v0 = t0[m + _m * (k + _k * x)];
        //                     v3 = v0
        //                     sum += mult * v0 * v3;
        //                 }
        //             }
        //             out[++idx] = sum;
        //         }
        //     }
        // }
        //

        console.timeEnd('time')
        console.log(out)
    }



</script>
</html>